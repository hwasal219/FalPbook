<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ãƒ•ã‚¡ãƒ«ã®åæ”¯å¸³</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#2196f3" />
  <link rel="icon" href="icon.png" />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic&display=swap');

    body {
      font-family: 'Zen Maru Gothic', sans-serif;
      padding: 16px;
      max-width: 700px;
      margin: auto;
      position: relative;
    }

    input, button {
      font-size: 1rem;
      margin: 4px;
      padding: 6px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 16px;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 6px;
      text-align: center;
    }

    th {
      background: #f0f0f0;
    }

    button {
      border-radius: 4px;
      cursor: pointer;
    }

    .edit-btn { background: #f39c12; color: white; border: none; padding: 4px 8px; }
    .delete-btn { background: #e74c3c; color: white; border: none; padding: 4px 8px; }
    .save-btn { background: #2ecc71; color: white; border: none; padding: 4px 8px; }
    .cancel-btn { background: #95a5a6; color: white; border: none; padding: 4px 8px; }

    /* ğŸ¥ ç¾½ã°ãŸããƒ•ã‚¡ãƒ«ã´ãƒ */
    #bird {
      position: fixed;
      bottom: 12px;
      right: 12px;
      width: 40px;
      animation: float 2s ease-in-out infinite;
      z-index: 100;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-6px); }
    }

    /* ğŸ’¬ å¹ãå‡ºã— */
    #message {
      position: fixed;
      bottom: 60px;
      right: 60px;
      background: #fff;
      border: 1px solid #ccc;
      padding: 6px 10px;
      border-radius: 10px;
      box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
      font-size: 0.9rem;
      display: none;
      z-index: 99;
    }

    /* ğŸª¶ ç¾½ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */
    .feather {
      position: fixed;
      bottom: 60px;
      right: 50px;
      font-size: 20px;
      opacity: 1;
      animation: floatUp 2s ease-out forwards;
      pointer-events: none;
      z-index: 98;
    }

    @keyframes floatUp {
      0% { transform: translateY(0); opacity: 1; }
      100% { transform: translateY(-80px); opacity: 0; }
    }
  </style>
</head>
<body>
  <h1>ãƒ•ã‚¡ãƒ«ã®åæ”¯å¸³</h1>
  <div>
    <input type="date" id="d" />
    <input list="items" id="i" placeholder="é …ç›®" />
    <datalist id="items"></datalist>
    <input type="number" id="inc" placeholder="åå…¥" />
    <input type="number" id="exp" placeholder="æ”¯å‡º" />
    <button id="btn" style="background:#007bff;color:white;">ç™»éŒ²</button>
  </div>
  <table>
    <thead>
      <tr><th>æ—¥ä»˜</th><th>é …ç›®</th><th>åå…¥</th><th>æ”¯å‡º</th><th>æ®‹é«˜</th><th>æ“ä½œ</th></tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>

  <!-- ğŸ¥ å³ä¸‹ã®ãƒ•ã‚¡ãƒ«ã´ãƒ -->
  <img id="bird" src="icon.png" alt="ãƒ•ã‚¡ãƒ«" />

  <!-- ğŸ’¬ ãƒãƒ¥ãƒ³â™ªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
  <div id="message">è¨˜éŒ²ã—ãŸã‚ˆï¼ãƒãƒ¥ãƒ³â™ª</div>

  <script>
    const d = document.getElementById('d');
    const i = document.getElementById('i');
    const inc = document.getElementById('inc');
    const exp = document.getElementById('exp');
    const btn = document.getElementById('btn');
    const tbody = document.getElementById('tbody');
    const itemsList = document.getElementById('items');
    const msg = document.getElementById('message');

    d.value = new Date().toISOString().slice(0,10);
    let entries = JSON.parse(localStorage.getItem('entries') || '[]');
    let itemHistory = JSON.parse(localStorage.getItem('itemHistory') || '[]');

    function saveAndRender() {
      entries.sort((a, b) => new Date(a.date) - new Date(b.date));
      let balance = 0;
      entries.forEach(e => {
        balance += e.income - e.expense;
        e.balance = balance;
      });
      localStorage.setItem('entries', JSON.stringify(entries));
      render();
    }

    function render() {
      tbody.innerHTML = '';
      entries.forEach((e, index) => {
        const tr = document.createElement('tr');
        if (e.editing) {
          tr.innerHTML = `
            <td><input type="date" value="${e.date}" id="edit-date-${index}"></td>
            <td><input type="text" value="${e.item}" id="edit-item-${index}"></td>
            <td><input type="number" value="${e.income}" id="edit-inc-${index}"></td>
            <td><input type="number" value="${e.expense}" id="edit-exp-${index}"></td>
            <td>--</td>
            <td>
              <button class="save-btn" onclick="saveEdit(${index})">ä¿å­˜</button>
              <button class="cancel-btn" onclick="cancelEdit(${index})">å–æ¶ˆ</button>
            </td>`;
        } else {
          tr.innerHTML = `
            <td>${e.date}</td>
            <td>${e.item}</td>
            <td>${e.income ? e.income.toLocaleString() : ''}</td>
            <td>${e.expense ? e.expense.toLocaleString() : ''}</td>
            <td><b>${e.balance.toLocaleString()}</b></td>
            <td>
              <button class="edit-btn" onclick="editEntry(${index})">ä¿®æ­£</button>
              <button class="delete-btn" onclick="deleteEntry(${index})">å‰Šé™¤</button>
            </td>`;
        }
        tbody.appendChild(tr);
      });

      itemsList.innerHTML = '';
      itemHistory.forEach(h => {
        const opt = document.createElement('option');
        opt.value = h;
        itemsList.appendChild(opt);
      });
    }

    function deleteEntry(index) {
      if (!confirm('ã“ã®è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
      entries.splice(index, 1);
      saveAndRender();
    }

    function editEntry(index) {
      entries[index].editing = true;
      render();
    }

    function cancelEdit(index) {
      delete entries[index].editing;
      render();
    }

    function saveEdit(index) {
      const date = document.getElementById(`edit-date-${index}`).value;
      const item = document.getElementById(`edit-item-${index}`).value;
      const income = parseFloat(document.getElementById(`edit-inc-${index}`).value) || 0;
      const expense = parseFloat(document.getElementById(`edit-exp-${index}`).value) || 0;
      entries[index] = { date, item, income, expense, balance: 0 };
      if (!itemHistory.includes(item)) {
        itemHistory.push(item);
        localStorage.setItem('itemHistory', JSON.stringify(itemHistory));
      }
      saveAndRender();
    }

    btn.onclick = () => {
      if (!i.value || (!inc.value && !exp.value)) return;
      const amountIn = parseFloat(inc.value) || 0;
      const amountOut = parseFloat(exp.value) || 0;
      const e = { date: d.value, item: i.value, income: amountIn, expense: amountOut, balance: 0 };
      entries.push(e);
      if (!itemHistory.includes(i.value)) {
        itemHistory.push(i.value);
        localStorage.setItem('itemHistory', JSON.stringify(itemHistory));
      }
      i.value = ''; inc.value = ''; exp.value = '';
      saveAndRender();
      showMessage();
      showFeather();
    };

    function showMessage() {
      msg.style.display = 'block';
      setTimeout(() => { msg.style.display = 'none'; }, 2000);
    }

    function showFeather() {
      const feather = document.createElement('div');
      feather.className = 'feather';
      feather.innerText = 'ğŸª¶';
      document.body.appendChild(feather);
      setTimeout(() => { feather.remove(); }, 2000);
    }

    window.addEventListener('DOMContentLoaded', () => {
      saveAndRender();
    });
  </script>
</body>
</html>
